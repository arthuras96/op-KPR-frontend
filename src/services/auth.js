export const TOKEN_KEY = "@4u7x!z%C*F-JaNdRgUkXp2s5v8y/B?D(G+KbPeShVmYq3t6w9z$C&F)H@McQfTjW";
export const ROLE_KEY = "@mZq4t7w!z$C&F)J@NcRfUjXn2r5u8x/A?D*G-KaPdSgVkYp3s6v9y$B&E)H+MbQe";
export const IDPERSON_KEY = "@ShVmYq3t6w9z$B&E)H@McQfTjWnZr4u7x!A%D*F-JaNdRgUkXp2s5v8y/B?E(H+K";
export const USERNAME_KEY = "@D*G-KaPdSgVkYp3s6v9y$B?E(H+MbQeThWmZq4t7w!z%C*F)J@NcRfUjXn2r5u8x";
export const DATEEXPIRES_KEY = "@hVmYp3s6v9y$B&E)H@McQfTjWnZr4t7w!z%C*F-JaNdRgUkXp2s5v8x/A?D(G+Kb";
export const IDADMIN_KEY = "@06qS?ZY+0a]P@=-9Vj{rX1jwpEXL9dv'@fFySW[ZVSKrPgIEJ/#xrOMqK-O8_^Zd";
export const ALLPERMISSION_KEY = "@*?l5W8igm[k4s:a&Yn*|&+BLSG6%(UPPKyi3`*DdHF7*bmZl/B/U}wZ)@0H9%|,G";

//#region permissions keys
// export const P1_KEY = "@=;GI{/m4qp`AckejBOJ2vK/Wvdq@(54R3m%P:kB&@$.jb}#n*pN4@0kGuwH__m~D";
// export const P2_KEY = "@6q88IL?3lLuk05?9gT^*A'b@xn%ANq>OEvNx?oXZpCtQglYj@>PLqK=RIg92D:{x";
// export const P3_KEY = "@SH+/8;LwnGdLad^>Gl>RjG:D$#X~Ev^!b;xNVY1'SJTV<FP0<Tl]`xKY/muhp%`-";
// export const P4_KEY = "@l8g[uE7B6IXB2zzcg*:Jp7!eq'UxU&n#(1gYij7'65EhD]jn~%4yDQ1%5W%B&6e3";
// export const P5_KEY = "@AuT/+}%I^Ae8WK8[A$=}h|MJKuE]wG5Mv8x(9G13|MVy1YFr6E#l=(t<fL[`~;p4";
// export const P6_KEY = "@<wDICZdz^@K8?`yo>m9T4]Je#6p4q5C=&K'KO,7EZ_C07iPQnj:c,$C/P_9?I_q=";
// export const P7_KEY = "@1xEFYVg]C7d*-cpE,CrXm%FG6T,h(4:r=7eXqt`WOxjcng#L,FHoi:VG:6Gq;2Gu";
// export const P8_KEY = "@xi-N*^}tP¨S3{;R+ci'7rKRnY!<3%+m?P[I_#)3O$d;BtvwuKGf|v%Rx}qzqRZ|p";
// export const P9_KEY = "@]px-K$B{is[;*I/bhAK1TGzlO5Ohl5Xf7>K^:JK<,kaQY4kf89JF%&gUA``*PcXZ";
// export const P10_KEY = "@<Vhl'(QI)dJ0xpUIlq0Z/r=re7*@GZ53HqS~u7Rk[>go%e[8@`*H^S)hoEt3J':A";
// export const P11_KEY = "@_Eo6K+'x*~$XF3O,=/:4.HAWXl;M{#$Qr`sxdzd+5.oaG!>D/lEf!wwi)!7`#Vl&";
// export const P12_KEY = "@j_1t9XE1&S(xm6B%d<ux0=ZkA'4&F:7J_],^T<&+_Q}mDh-7Cm(T]P_EKv#/c<a3";
// export const P13_KEY = "@jetMa+$(CM}KCHL^,~c5SW>z_eD+V3qg:%&Q@`QI[[;PJ]0:v2tpz7}Ky{]'{i%A";
// export const P14_KEY = "@Bduxi-VzRt#!jneZ%&7{W_,[[0$wMmE-!%&t'r.Mq[DN0DTFOt{Uq~uBB7wrXD$1";
// export const P15_KEY = "@5>~KRH6|l)t;uOK+/{b_en1V{b01I$#K]TORg6%jv/mq?<VhZ[L9$o@]U#C&,>N3";
// export const P16_KEY = "@vw{daX<|60`&MGP9nI4Cx/D2`UTvjjt`hvJN[`p^G$.SQOh9-%&2.(b};~IKwaf#";
// export const P17_KEY = "@P^T]'u&N8~KJPks5kmVlM!hFq+fo8J/2+pG{_tiB&-zBadqs^2?v?NG1w2p:a5~f";
// export const P18_KEY = "@K(9u;,5`|.q0aAvsVAd@xAn8N4b-G%Ib?iU4ysJ~iW$!wI)asd2On}*HH6f3)U/=";
// export const P19_KEY = "@o}`yM|^g{vce8Anj=#.PeP5};5jSEJ4S6YGM!'F}@{V#bD)$yR`|.j;_mqAI/&D;";
// export const P20_KEY = "@5}V5Y*=z'f8HpadsJ&cjIB1@_EUAm>TU@d~>%`FlAi9y.Nk;!sSXjbU8Q)lw(A4.";
// export const P21_KEY = "@d]yv_cGJLQ*Y/p#pZ>0`Lwn`|J@kS^2C$OSoLzSLh(qIDNBq{mg'sd>n|4VEt^w$";
// export const P22_KEY = "@(@.a`rj,/fR^TYPUg1(TA3wss^ja'D2(+ViW3?|ip+.Pw]ln+=!.-UvbM#&{<g4.";
// export const P23_KEY = "@dT&Io1sQit(q1kozaK<[u.CsZ7cGGI.Vk|n|4^wbKATzHWqWt>{-YuoCGn`vJqp¢";
// export const P24_KEY = "@)6(UDASc<_,oZ5e0l~Z00RWpVdxvl;s4(.&uswELys]dWt!e9r5FywfGS/52!f`;";
// export const P25_KEY = "@1nUp|Zdhk9g7z)j4U0ubdUw.YxE3n'7!vg?P4e9#qT<TJb%(-Yx51%yWnDa)$vC<";
// export const P26_KEY = "@d2.TewQ>UiQ0?_b-m*-e!o{05p:+!1<.V)435`_/5)fYNL0TdL@,bW%=SPAbdH.2";
// export const P27_KEY = "@~l4^L2b!sxpV4Id&36blTCPD~Znudgq<:Z6H4FEP](aYLnM=O$W9j4lj~4Ugv;T§";
// export const P28_KEY = "@NKwt+]UE8FCBg6%kR{4j7zl;3$V^iX*zWD4+3/lGnVjlfm%1:o`sVdZ#L[SBce2%";
// export const P29_KEY = "@=`ES+K+ApYqmTzv9zU=&gL4GT#?TAuOazh'E7.sY'`.8vttt{a%u$?p-3'r?J2[O";

export const P_KEYS = [
    "",
    "@=;GI{/m4qp`AckejBOJ2vK/Wvdq@(54R3m%P:kB&@$.jb}#n*pN4@0kGuwH__m~D",	//1	- Auditoria	- Permissão para os usuários acessarem os dados de auditoria do sistema.
    "@6q88IL?3lLuk05?9gT^*A'b@xn%ANq>OEvNx?oXZpCtQglYj@>PLqK=RIg92D:{x",	//2	- Auditoria de e-mails - Permissão para visualizar os envios de e-mail.
    "@SH+/8;LwnGdLad^>Gl>RjG:D$#X~Ev^!b;xNVY1'SJTV<FP0<Tl]`xKY/muhp%`-",	//3	- Auditoria do sistema - Permissão para os usuários acessarem os dados de auditoria dos cadastros do sistema.
    "@l8g[uE7B6IXB2zzcg*:Jp7!eq'UxU&n#(1gYij7'65EhD]jn~%4yDQ1%5W%B&6e3",	//4	- Relatórios - Permissão para gerar relatórios.
    "@AuT/+}%I^Ae8WK8[A$=}h|MJKuE]wG5Mv8x(9G13|MVy1YFr6E#l=(t<fL[`~;p4",	//5	- Relatório de acesso - Permissão para gerar relatórios de acesso.
    "@<wDICZdz^@K8?`yo>m9T4]Je#6p4q5C=&K'KO,7EZ_C07iPQnj:c,$C/P_9?I_q=",	//6	- Relatório de ocorrência - Permissão para gerar relatórios de ocorrências.
    "@1xEFYVg]C7d*-cpE,CrXm%FG6T,h(4:r=7eXqt`WOxjcng#L,FHoi:VG:6Gq;2Gu",	//7	- Relatório de pessoa - Permissão para gerar relatórios de pessoas.
    "@xi-N*^}tP¨S3{;R+ci'7rKRnY!<3%+m?P[I_#)3O$d;BtvwuKGf|v%Rx}qzqRZ|p",	//8	- Conta - Permissão para acesso a visão geral de contas.
    "@]px-K$B{is[;*I/bhAK1TGzlO5Ohl5Xf7>K^:JK<,kaQY4kf89JF%&gUA``*PcXZ",	//9	- Edição de conta - Permissão para cadastrar e editar dados cadastrais da conta.
    "@<Vhl'(QI)dJ0xpUIlq0Z/r=re7*@GZ53HqS~u7Rk[>go%e[8@`*H^S)hoEt3J':A",	//10 - Configuração da conta - Permissão para editar configurações da conta.
    "@_Eo6K+'x*~$XF3O,=/:4.HAWXl;M{#$Qr`sxdzd+5.oaG!>D/lEf!wwi)!7`#Vl&",	//11 - Dispositivos da conta - Permissão para cadastrar e editar dispositivos.
    "@j_1t9XE1&S(xm6B%d<ux0=ZkA'4&F:7J_],^T<&+_Q}mDh-7Cm(T]P_EKv#/c<a3",	//12 - Câmeras da conta - Permissão para cadastrar e editar câmeras.
    "@jetMa+$(CM}KCHL^,~c5SW>z_eD+V3qg:%&Q@`QI[[;PJ]0:v2tpz7}Ky{]'{i%A",	//13 - Zonas da conta - Permissão para cadastrar e editar zonas.
    "@Bduxi-VzRt#!jneZ%&7{W_,[[0$wMmE-!%&t'r.Mq[DN0DTFOt{Uq~uBB7wrXD$1",	//14 - Horários da conta - Permissão para cadastrar e editar perfis de horário.
    "@5>~KRH6|l)t;uOK+/{b_en1V{b01I$#K]TORg6%jv/mq?<VhZ[L9$o@]U#C&,>N3",	//15 - Pessoas da conta - Permissão para cadastrar e editar pessoas.
    "@vw{daX<|60`&MGP9nI4Cx/D2`UTvjjt`hvJN[`p^G$.SQOh9-%&2.(b};~IKwaf#",	//16 - Cadastro de funcionários - Permissão para cadastrar funcionários.
    "@P^T]'u&N8~KJPks5kmVlM!hFq+fo8J/2+pG{_tiB&-zBadqs^2?v?NG1w2p:a5~f",	//17 - Cadastro de moradores - Permissão para cadastrar moradores.
    "@K(9u;,5`|.q0aAvsVAd@xAn8N4b-G%Ib?iU4ysJ~iW$!wI)asd2On}*HH6f3)U/=",	//18 - Cadastro de prestadores de serviço - Permissão para cadastrar prestadores de serviço.
    "@o}`yM|^g{vce8Anj=#.PeP5};5jSEJ4S6YGM!'F}@{V#bD)$yR`|.j;_mqAI/&D;",	//19 - Cadastro de visitantes - Permissão para cadastrar visitantes.
    "@5}V5Y*=z'f8HpadsJ&cjIB1@_EUAm>TU@d~>%`FlAi9y.Nk;!sSXjbU8Q)lw(A4.",	//20 - Unidades da conta - Permissão para cadastrar e editar unidades.
    "@d]yv_cGJLQ*Y/p#pZ>0`Lwn`|J@kS^2C$OSoLzSLh(qIDNBq{mg'sd>n|4VEt^w$",	//21 - Veículos da conta - Permissão para cadastrar e editar veículos.
    "@(@.a`rj,/fR^TYPUg1(TA3wss^ja'D2(+ViW3?|ip+.Pw]ln+=!.-UvbM#&{<g4.",	//22 - Eventos da conta - Permissão para cadastrar e editar eventos.
    "@dT&Io1sQit(q1kozaK<[u.CsZ7cGGI.Vk|n|4^wbKATzHWqWt>{-YuoCGn`vJqp¢",	//23 - Ações da conta - Permissão para cadastrar e editar ações.
    "@)6(UDASc<_,oZ5e0l~Z00RWpVdxvl;s4(.&uswELys]dWt!e9r5FywfGS/52!f`;",	//24 - Monitoramento - Permissão para acessar a página de monitoramento, cadastrar visitantes, atender ocorrências e executar ações.
    "@1nUp|Zdhk9g7z)j4U0ubdUw.YxE3n'7!vg?P4e9#qT<TJb%(-Yx51%yWnDa)$vC<",	//25 - Assumir ocorrências - Permissão para assumir a responsabilidade das ocorrências em atendimento por outros usuários.
    "@d2.TewQ>UiQ0?_b-m*-e!o{05p:+!1<.V)435`_/5)fYNL0TdL@,bW%=SPAbdH.2",	//26 - Usuário - Permissão para cadastrar e editar outros usuários.
    "@~l4^L2b!sxpV4Id&36blTCPD~Znudgq<:Z6H4FEP](aYLnM=O$W9j4lj~4Ugv;T§",	//27 - Perfil de usuário - Permissão para cadastrar e editar perfis de usuários.
    "@NKwt+]UE8FCBg6%kR{4j7zl;3$V^iX*zWD4+3/lGnVjlfm%1:o`sVdZ#L[SBce2%",	//28 - Resoluções - Permissão para cadastrar e editar resoluções.
    "@=`ES+K+ApYqmTzv9zU=&gL4GT#?TAuOazh'E7.sY'`.8vttt{a%u$?p-3'r?J2[O",	//29 - Horários globais - Permissão para cadastrar e editar perfis de horário globais.
    "@`Id2]FBEF@/[UklR':`0Qv.aALOveQfI/RA:k.NuzH2Ud0};?ni,~A;7lrtel_<D",    //30 - Eventos globais - Permissão para cadastrar e editar eventos globais.
    "@M1bNTJGPVRhFa_@)Gv,>Mu1a!C-==rR;A_LpUjt0ds:dnoDYtwChg:Dj`?1>N5d$",    //31 - Integrações - Permissão para cadastrar e editar integrações.
    "@p^M+D#/kxn,5p1dK^t]enlkc[@J8H4X@{)!J-X&hR#^4YMV'ev:|r2(lm?C/3}nF"     //32 - Configurações - Permissão para os usuários acessarem as configurações do sistema.
]
//#endregion


export const IsAuthenticated = () => {

    if (localStorage.getItem(TOKEN_KEY) !== null) {
        if (localStorage.getItem(DATEEXPIRES_KEY) > Date.now())
            return true;
        else {
            const auxTheme = localStorage.getItem("theme");
            localStorage.clear();
            localStorage.setItem("theme", auxTheme);
            return false;
        }
    }
    else
        return false;
}

export const GetToken = () => localStorage.getItem(TOKEN_KEY);

export const SaveKeys = data => {

    let jsonPermission = "{";

    try {

        //let largest = Math.max.apply(Math, data.permission);

        for (let indexPermission = 1; indexPermission <= P_KEYS.length; indexPermission++) {

            for (let indexStartObfuscate = 0; indexStartObfuscate < 20; indexStartObfuscate++) {
                let auxKey = P_KEYS[indexPermission];
                let valueChange = Math.floor(Math.random() * auxKey.length);
                let altValue = Math.floor(Math.random() * 50) + 1;

                const obfuscateValue = Math.floor(Math.random() * 1);

                if (auxKey.charCodeAt(valueChange) <= altValue) {
                    auxKey = auxKey.substr(0, valueChange - 1) + Utf8ArrayToStr(auxKey.charCodeAt(valueChange) + altValue) + auxKey.substr(valueChange + 1, auxKey.length);
                    //auxKey[valueChange] = auxKey.charCodeAt(valueChange) + altValue;
                }
                else {
                    auxKey = auxKey.substr(0, valueChange - 1) + Utf8ArrayToStr(auxKey.charCodeAt(valueChange) - altValue) + auxKey.substr(valueChange + 1, auxKey.length);
                    //auxKey[valueChange] = auxKey.charCodeAt(valueChange) - altValue;
                }

                if (obfuscateValue === 0)
                    jsonPermission = jsonPermission + '"' + auxKey + '":' + 'false,';
                else
                    jsonPermission = jsonPermission + '"' + auxKey + '":' + 'true,';
            }

            if (data.permission.indexOf(indexPermission) !== -1) {
                let auxKey = P_KEYS[indexPermission];
                jsonPermission = jsonPermission + '"' + auxKey + '":' + 'true,';
                console.log("Opa nenem: " + indexPermission);
            }
            else {
                let auxKey = P_KEYS[indexPermission];
                jsonPermission = jsonPermission + '"' + auxKey + '":' + 'false,';
                console.log("Hoje não: " + indexPermission);
            }


            for (let indexStartObfuscate = 0; indexStartObfuscate < 25; indexStartObfuscate++) {
                let auxKey = P_KEYS[indexPermission];
                const valueChange = Math.floor(Math.random() * auxKey.length);
                const altValue = Math.floor(Math.random() * 50) + 1;

                const obfuscateValue = Math.floor(Math.random() * 2);

                if (auxKey.charCodeAt(valueChange) <= altValue) {
                    auxKey = auxKey.substr(0, valueChange - 1) + Utf8ArrayToStr(auxKey.charCodeAt(valueChange) + altValue) + auxKey.substr(valueChange + 1, auxKey.length);
                    //auxKey[valueChange] = auxKey.charCodeAt(valueChange) + altValue;
                }
                else {
                    auxKey = auxKey.substr(0, valueChange - 1) + Utf8ArrayToStr(auxKey.charCodeAt(valueChange) - altValue) + auxKey.substr(valueChange + 1, auxKey.length);
                    //auxKey[valueChange] = auxKey.charCodeAt(valueChange) - altValue;
                }

                if (obfuscateValue === 0)
                    jsonPermission = jsonPermission + '"' + auxKey + '":' + 'false,';
                else
                    jsonPermission = jsonPermission + '"' + auxKey + '":' + 'true,';
            }
        }
    }
    catch (err) {
        console.log(err);
    }

    jsonPermission = jsonPermission.substr(0, jsonPermission.length - 1) + "}";

    localStorage.setItem(ALLPERMISSION_KEY, jsonPermission);
    localStorage.setItem(TOKEN_KEY, data.token);
    localStorage.setItem(ROLE_KEY, data.role);
    localStorage.setItem(IDPERSON_KEY, data.idperson);
    localStorage.setItem(USERNAME_KEY, data.name);
    localStorage.setItem(DATEEXPIRES_KEY, Date.now() + 36000000);
    localStorage.setItem(IDADMIN_KEY, data.idadmin);
};

export const Logout = () => {
    const auxTheme = localStorage.getItem("theme");
    localStorage.clear();
    localStorage.setItem("theme", auxTheme);
    window.location.reload();
};

export const IsRoot = () => {
    const role = localStorage.getItem(ROLE_KEY);
    if (role === "root")
        return true;

    return false;
};
export const IsAdmin = () => {
    const role = localStorage.getItem(ROLE_KEY);
    if (role === "root" || role === "admin")
        return true;

    return false;
};

export const IsUser = () => {
    const role = localStorage.getItem(ROLE_KEY);
    if (role === "root" || role === "admin" || role === "user")
        return true;

    return false;
};

export const IsResident = () => {
    const role = localStorage.getItem(ROLE_KEY);
    if (role === "resident")
        return true;

    return false;
};

export const HavePermission = (indexPermission) => {
    const listPermissions = JSON.parse(localStorage.getItem(ALLPERMISSION_KEY));
    return listPermissions[P_KEYS[indexPermission]];
}

function Utf8ArrayToStr(array) {
    var out, i, len, c;
    var char2, char3;

    out = "";
    len = array.length;
    i = 0;
    while (i < len) {
        c = array[i++];
        switch (c >> 4) {
            case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:
                // 0xxxxxxx
                out += String.fromCharCode(c);
                break;
            case 12: case 13:
                // 110x xxxx   10xx xxxx
                char2 = array[i++];
                out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));
                break;
            case 14:
                // 1110 xxxx  10xx xxxx  10xx xxxx
                char2 = array[i++];
                char3 = array[i++];
                out += String.fromCharCode(((c & 0x0F) << 12) |
                    ((char2 & 0x3F) << 6) |
                    ((char3 & 0x3F) << 0));
                break;
        }
    }

    return out;
}

export const GetUsername = () => localStorage.getItem(USERNAME_KEY);
export const GetIdPerson = () => localStorage.getItem(IDPERSON_KEY);
export const GetIdAdmin = () => localStorage.getItem(IDADMIN_KEY);